---
title: "Homework Assignment 1"
author: "Claes Kock, Yuchong Wu, Mayara Latrech"
Date: "10/12/2019"
header-includes:
   - \usepackage{array}
   - \usepackage{float}
output:
  pdf_document:
    number_sections: yes
---

# Begin document


\newpage

\tableofcontents

\newpage


```{r setup, include=FALSE, message=FALSE}
knitr::opts_chunk$set(fig.pos = 'H', echo = FALSE)
library(knitr)
library(ggplot2)
library(tidyverse)
library(dummies)
library(DT)
library(lmtest)
```

# Abstract

# Introduction

# Theory

We transform our data by removing all subjects who answered "I don't know" and those who gave no answer. We decided to keep thoso who refused to answer. The logic behind that is refusing to answer is a valid statement and not a case of ignorance. After applying this transformation we apply a logit model:
$$P(X=1|X_1,X_2,...,X_k)=F(\beta_0+\beta_1X_1+...+\beta_kX_k) $$
Where,
$$F(x)=\frac{1}{1+e^{-x}}$$

$\beta_0,\beta_1,..,\beta_k$ are the parameters of the model to be estimated. $X_1,X_2,...,X_k$ are the dependant variables and $X$ is the variable to explain which is "socialdemocrates" in our dataset.

# Data

Our data is from the European Social Survey, which is a biannual multicountry survey. This survey measures attitudes, beliefs and behaviours across the European Union. Our dataset is the survey from 2006 and contains a total of 487 variables from 1927 respondents. However, we are only going to use the variables that are relevant to swedish politics.

Thus we use a total of 24 variables from this dataset, plus some dummy variables. We have the following variables:



```{r}
dat_vote <- read.csv("vote_parties.csv", na.strings = "No answer")
dat <- read.csv("vote_parties.csv", na.strings = c("No answer", "Don't know"))
dat <- na.omit(dat)
names(dat)[names(dat) == "a5"] <- "PaperTime"
names(dat)[names(dat) == "b1"] <- "PoInt"
names(dat)[names(dat) == "b11"] <- "VoteLast"
names(dat)[names(dat) == "b12"] <- "VoteParty"
names(dat)[names(dat) == "c1"] <- "HapScale"
names(dat)[names(dat) == "c5"] <- "Crime5year"
names(dat)[names(dat) == "c15"] <- "HealthLvl"
names(dat)[names(dat) == "c28"] <- "SweBorn"
names(dat)[names(dat) == "c33"] <- "FSweBorn"
names(dat)[names(dat) == "c35"] <- "MSweBorn"
names(dat)[names(dat) == "d4"] <- "Spouse3year"
names(dat)[names(dat) == "d6"] <- "Married"
names(dat)[names(dat) == "d9"] <- "TotalChildren"
names(dat)[names(dat) == "e4"] <- "OptLvl"
names(dat)[names(dat) == "e5"] <- "PosLvl"
names(dat)[names(dat) == "e7"] <- "SatLvl"
names(dat)[names(dat) == "f1"] <- "FamSize"
names(dat)[names(dat) == "f2"] <- "Gender"
names(dat)[names(dat) == "f3"] <- "Bdate"
names(dat)[names(dat) == "f5"] <- "Area"
names(dat)[names(dat) == "f27"] <- "FormUnemp"
names(dat)[names(dat) == "f30"] <- "TradeUn"
names(dat)[names(dat) == "f32"] <- "IncLvl"
levels(dat$VoteParty)
```

```{r}

dat_t = dat

dat_t$PaperTime = as.character(dat_t$PaperTime)
dat_t$PaperTime[dat_t$PaperTime == "No time at all"] = 0
dat_t$PaperTime[dat_t$PaperTime == "Less than 0,5 hour"] = 1
dat_t$PaperTime[dat_t$PaperTime == "0,5 hour to 1 hour"] = 2
dat_t$PaperTime[dat_t$PaperTime == "More than 1 hour, up to "] = 3
dat_t$PaperTime[dat_t$PaperTime == "More than 1,5 hours, up "] = 4
dat_t$PaperTime[dat_t$PaperTime == "More than 2 hours, up to"] = 5
dat_t$PaperTime[dat_t$PaperTime == "More than 2,5 hours, up to"] = 6
dat_t$PaperTime[dat_t$PaperTime == "More than 2,5 hours, up "] = 6
dat_t$PaperTime[dat_t$PaperTime == "More than 3 hours"] = 7
dat_t$PaperTime[dat_t$PaperTime == "Don't know"] = 88

dat_t$PoInt = as.character(dat_t$PoInt)
dat_t$PoInt[dat_t$PoInt == "Very interested"] = 1
dat_t$PoInt[dat_t$PoInt == "Quite interested"] = 2
dat_t$PoInt[dat_t$PoInt == "Hardly interested"] = 3
dat_t$PoInt[dat_t$PoInt == "Not at all interested"] = 4
dat_t$PoInt[dat_t$PoInt == "Don't know"] = 88

dat_t$VoteLast = as.character(dat_t$VoteLast)
dat_t$VoteLast[dat_t$VoteLast == "Yes"] = 1
dat_t$VoteLast[dat_t$VoteLast == "No"] = 2
dat_t$VoteLast[dat_t$VoteLast == "Not eligible to vote"] = 3
dat_t$VoteLast[dat_t$VoteLast == "Don't know"] = 88

dat_t$HapScale = as.character(dat_t$HapScale)
dat_t$HapScale[dat_t$HapScale == "Extremely unhappy"] = 0
dat_t$HapScale[dat_t$HapScale == "Extremely happy"] = 10
dat_t$HapScale[dat_t$HapScale == "Refusal"] = 99
dat_t$HapScale[dat_t$HapScale == "Don't know"] = 88

dat_t$HealthLvl = as.character(dat_t$HealthLvl)
dat_t$HealthLvl[dat_t$HealthLvl == "Very good"] = 1
dat_t$HealthLvl[dat_t$HealthLvl == "Good"] = 2
dat_t$HealthLvl[dat_t$HealthLvl == "Fair"] = 3
dat_t$HealthLvl[dat_t$HealthLvl == "Bad"] = 4
dat_t$HealthLvl[dat_t$HealthLvl == "Very bad"] = 5
dat_t$HealthLvl[dat_t$HealthLvl == "Don't know"] = 88

dat_t$SweBorn = as.character(dat_t$SweBorn)
dat_t$SweBorn[dat_t$SweBorn == "Yes"] = 1
dat_t$SweBorn[dat_t$SweBorn == "No"] = 2
dat_t$SweBorn[dat_t$SweBorn == "Don't know"] = 88

dat_t$FSweBorn = as.character(dat_t$FSweBorn)
dat_t$FSweBorn[dat_t$FSweBorn == "Yes"] = 1
dat_t$FSweBorn[dat_t$FSweBorn == "No"] = 2
dat_t$FSweBorn[dat_t$FSweBorn == "Don't know"] = 88

dat_t$MSweBorn = as.character(dat_t$MSweBorn)
dat_t$MSweBorn[dat_t$MSweBorn == "Yes"] = 1
dat_t$MSweBorn[dat_t$MSweBorn == "No"] = 2
dat_t$MSweBorn[dat_t$MSweBorn == "Don't know"] = 88

dat_t$Crime5year = as.character(dat_t$Crime5year)
dat_t$Crime5year[dat_t$Crime5year == "Yes"] = 1
dat_t$Crime5year[dat_t$Crime5year == "No"] = 2
dat_t$Crime5year[dat_t$Crime5year == "Don't know"] = 88

dat_t$Spouse3year = as.character(dat_t$Spouse3year)
dat_t$Spouse3year[dat_t$Spouse3year == "Yes"] = 1
dat_t$Spouse3year[dat_t$Spouse3year == "No"] = 2
dat_t$Spouse3year[dat_t$Spouse3year == "Don't know"] = 88

dat_t$Married = as.character(dat_t$Married)
dat_t$Married[dat_t$Married == "Yes"] = 1
dat_t$Married[dat_t$Married == "No"] = 2

dat_t$TotalChildren = as.character(dat_t$TotalChildren)
dat_t$TotalChildren[dat_t$TotalChildren == "Not applicable"] = 0
dat_t$TotalChildren[dat_t$TotalChildren == "1.000000"] = 1
dat_t$TotalChildren[dat_t$TotalChildren == "2.000000"] = 2
dat_t$TotalChildren[dat_t$TotalChildren == "3.000000"] = 3
dat_t$TotalChildren[dat_t$TotalChildren == "4.000000"] = 4
dat_t$TotalChildren[dat_t$TotalChildren == "5.000000"] = 5
dat_t$TotalChildren[dat_t$TotalChildren == "6.000000"] = 6
dat_t$TotalChildren[dat_t$TotalChildren == "7.000000"] = 7
dat_t$TotalChildren[dat_t$TotalChildren == "8.000000"] = 8
dat_t$TotalChildren[dat_t$TotalChildren == "9.000000"] = 9
dat_t$TotalChildren[dat_t$TotalChildren == "10.000000"] = 10
dat_t$TotalChildren[dat_t$TotalChildren == "11.000000"] = 11
dat_t$TotalChildren[dat_t$TotalChildren == "12.00000"] = 12

dat_t$OptLvl = as.character(dat_t$OptLvl)
dat_t$OptLvl[dat_t$OptLvl == "Agree strongly"] = 1
dat_t$OptLvl[dat_t$OptLvl == "Agree"] = 2
dat_t$OptLvl[dat_t$OptLvl == "Neither agree nor disagr"] = 3
dat_t$OptLvl[dat_t$OptLvl == "Disagree"] = 4
dat_t$OptLvl[dat_t$OptLvl == "Disagree strongly"] = 5
dat_t$OptLvl[dat_t$OptLvl == "Don't know"] = 88

dat_t$PosLvl = as.character(dat_t$PosLvl)
dat_t$PosLvl[dat_t$PosLvl == "Agree strongly"] = 1
dat_t$PosLvl[dat_t$PosLvl == "Agree"] = 2
dat_t$PosLvl[dat_t$PosLvl == "Neither agree nor disagr"] = 3
dat_t$PosLvl[dat_t$PosLvl == "Disagree"] = 4
dat_t$PosLvl[dat_t$PosLvl == "Disagree strongly"] = 5
dat_t$PosLvl[dat_t$PosLvl == "Don't know"] = 88

dat_t$SatLvl = as.character(dat_t$SatLvl)
dat_t$SatLvl[dat_t$SatLvl == "Agree strongly"] = 1
dat_t$SatLvl[dat_t$SatLvl == "Agree"] = 2
dat_t$SatLvl[dat_t$SatLvl == "Neither agree nor disagr"] = 3
dat_t$SatLvl[dat_t$SatLvl == "Disagree"] = 4
dat_t$SatLvl[dat_t$SatLvl == "Disagree strongly"] = 5
dat_t$SatLvl[dat_t$SatLvl == "Don't know"] = 88

dat_t$Gender = as.character(dat_t$Gender)
dat_t$Gender[dat_t$Gender == "Male"] = 1
dat_t$Gender[dat_t$Gender == "Female"] = 2

dat_t$FormUnemp = as.character(dat_t$FormUnemp)
dat_t$FormUnemp[dat_t$FormUnemp == "Yes"] = 1
dat_t$FormUnemp[dat_t$FormUnemp == "No"] = 2
dat_t$FormUnemp[dat_t$FormUnemp == "Don't know"] = 88

dat_t$TradeUn = as.character(dat_t$TradeUn)
dat_t$TradeUn[dat_t$TradeUn == "Yes, currently"] = 1
dat_t$TradeUn[dat_t$TradeUn == "Yes, previously"] = 2
dat_t$TradeUn[dat_t$TradeUn == "No"] = 3
dat_t$TradeUn[dat_t$TradeUn == "Don't know"] = 88

dat_t$IncLvl = as.character(dat_t$IncLvl)
dat_t$IncLvl[dat_t$IncLvl == "J"] = 1
dat_t$IncLvl[dat_t$IncLvl == "R"] = 2
dat_t$IncLvl[dat_t$IncLvl == "C"] = 3
dat_t$IncLvl[dat_t$IncLvl == "M"] = 4
dat_t$IncLvl[dat_t$IncLvl == "F"] = 5
dat_t$IncLvl[dat_t$IncLvl == "S"] = 6
dat_t$IncLvl[dat_t$IncLvl == "K"] = 7
dat_t$IncLvl[dat_t$IncLvl == "P"] = 8
dat_t$IncLvl[dat_t$IncLvl == "D"] = 9
dat_t$IncLvl[dat_t$IncLvl == "H"] = 10
dat_t$IncLvl[dat_t$IncLvl == "U"] = 11
dat_t$IncLvl[dat_t$IncLvl == "N"] = 12
dat_t$IncLvl[dat_t$IncLvl == "Refusal"] = 77
dat_t$IncLvl[dat_t$IncLvl == "Don't know"] = 88

dat_t$Area = as.character(dat_t$Area)
dat_t$Area[dat_t$Area == "A big city"] = 1
dat_t$Area[dat_t$Area == "Suburbs or outskirts of "] = 2
dat_t$Area[dat_t$Area == "Town or small city"] = 3
dat_t$Area[dat_t$Area == "Country village"] = 4
dat_t$Area[dat_t$Area == "Farm or home in countrys"] = 5
dat_t$Area[dat_t$Area == "Don't know"] = 88
```


# Result

# 1) Descriptive Statistics

1)In order to know how the voters voted in the last general election in Sweden, we draw a barplot of how many votes each party got. Since we are intrested in voters only this task, we do not take into account people who are not applicable, who refused to answer the survey, who do not know and who did not give an answer.

```{r}
dat %>% 
  filter(VoteParty != "NOT APPLICABLE") %>% 
  filter(VoteParty != "REFUSAL") %>% 
  filter(VoteParty != "DONT KNOW") %>% 
  filter(VoteParty != "NO ANSWER") %>% 
  ggplot(mapping = aes(x = VoteParty)) +
  geom_bar(aes(y = (..count..)/sum(..count..), fill = factor(..x..))) +
  scale_y_continuous(labels=scales::percent) +
  ylab("Percentage") +
  guides(fill = "none") +
  coord_flip()
```

We notice that the Social Democrats received the largest share of the votes, 32%. The left party got the least amount of votes with 6% of the total votes. It seems like most people either vote for the right wing or the left wing. The Centre party does not seem that popular. We also notice that people prefer parties that are not in either extreme; the left party, liberal party and the christian democrats are not popular compared to the social democrates and the conservative party. The Green party does not seem that popular as well, it got only 8% of the total votes. Overall, it seems like voters are more left leaning when voting to various parties




## 2) Logit model

We have too much data and will have to restrict the amount of variables we use in our logit-model. We have selected a couple variables which we think will have a high impact

1) If an individual has a high satisfaction level, we expect s/he would have a higher chance to vote for the same political party. We can see this variable as a sign of discontent if it is low. 

2) We expect birthdate to have a negative correlation, as the older generation has a grew up in a society dominated by SocDem for almost 50 years. The younger generation might have a less nostalgic image of the party. 

3) In the same vein, we expect trade union members to be more likely on average to vote SocDem, due to the symbiotic relationship between labor and SocDem in Sweden, especially in 2006. 

4) Political interest could be a positve correlation, since the social democrats have been a major force in swedish politics for decades, and a high political interest could increase the chance to vote overall, instead of the individual staying at home due to having no interest in politics. 

5) A high family size is a socio-demographic factor which is often correlated with working class households - we expect larger households to have a higher chance to vote for SocDem for this reason. 

6) Finally, the typ of area that the individual is living in could also be a positive impact wether they vote SocDem, since a lot of industry is spread out over the smaller cities and countryside, where as cities might be expected to have a higher chance to vote for liberal parties.

```{r}

dat_t$PoInt <- as.numeric(dat_t$PoInt)
dat_t$TradeUn <- as.numeric(dat_t$TradeUn)
dat_t$FamSize <- as.numeric(dat_t$FamSize)
dat_t$Area <- as.numeric(dat_t$Area)

m <- glm(as.factor(socialdemocrats) ~ PoInt+TradeUn+FamSize+Area, data = dat_t, 
         family = binomial(link='logit'))

summary(m)

# Getting log likelihood value (for test of likert restriction)
logLik(m)
```


## 3.1) Intepretation of parameters

After estimating our model, we obtain $\hat\beta_0,...,\hat\beta_{4}$ estimates of the parameters of the model. $\hat\beta_0,...,\hat\beta_{3}$ are significant and $\hat\beta_{4}$ is not significant.
- For every one unit increase in the Political Intrest, the log odds of voting for the Social democrates increases by `r m$coefficients[2]`, holding other variables constant.
- For every one unit increase in being a member of the Trade Union, the log odds of voting for the Social democrates decreases by `r m$coefficients[3]`, holding other variables constant.
- For every one unit increase in family size, the log odds of voting for the Social democrates decreases by `r m$coefficients[4]`, holding other variables constant.

## 3.2) Picking one sample point
```{r}
preds <- predict.glm(m, dat_t, type="response")
```

Let us now try to choose one sample point and calculate the probability of the chosen individual to vote for the Scial democrats, if we choose the $15^{th}$ individual for example, the probability stemmed from the model would be `r preds[15]`.

```{r}

# Predict individ 15
id15 = dat_t[15, ]
# response returns predictions as probability (not log odds)
pred <- predict.glm(m, id15, type="response")

# change a value of id15 to
id15$Area = 5
pred2 = predict.glm(m, id15, type="response")

# Difference in probability 
pred-pred2

```

We want to see what happens when we manipulate the regressors of a single individual. For that purpose we have picked out individual #15. This individual is "quite interested" in politics. We decided to change this value to observe how this effects the probability of voting SocDem. We can see a 7.55% increase in probability when we raise the level of interest in politics from "2" to "1". When we lower the value to "3", we instead get a -1.03% decrease in probability. Finally "4" gives us a decrease of -1.29%. Thus, when predicting probability, it would seem that a higher political interest has a higher correlation with voting SocDem, if we apply the results from looking at 1 individual on the entire dataset.

## 4) Likelihood Ratio test





```{r}


m1 <- glm(as.factor(socialdemocrats) ~ as.factor(PoInt)+TradeUn+FamSize+Area, data = dat_t, 
         family = binomial(link='logit'))

summary(m1)


lrtest(m, m1)
```


## 5) Observed v. Predicted
## 6) Probit model



# Conclusion

# Appendix









# Task3

```{r}

m <- glm(as.factor(socialdemocrats) ~ as.factor(PoInt)+as.factor(TradeUn)+as.factor(FamSize)+as.factor(Area), data = dat_t, 
         family = binomial(link='logit'))

summary(m)

# Getting log likelihood value (for test of likert restriction)
logLik(m)
```

After estimating our model, we obtain $\hat\beta_0,...,\hat\beta_{17}$ estimates of the parameters of the model. From those estimates, we obtain some that are significant and ones that are not. 
Being quite intrested in politics, versus being very intrested in politics, changes the log odds of voting for the social democrates by `r m$coefficients[2]`.
Being hardly intrested in politics, versus being very intrested in politics, changes the log odds of voting for the social democrates by `r m$coefficients[3]`.
Being a previous member of the trade union, versus being a current member of the trade union, changes the log odds of voting for the social democrates by `r m$coefficients[5]`.
Not being a member of the trade union at all, versus being a current member of the trade union, changes the log odds of voting for the social democrates by `r m$coefficients[6]`.

# Task 5

# Task 6

- If $ε_A$ and $ε_B$ follows an normal distribution, then $ε = (ε_A-ε_B )$
follows a normal distribution, then we will get the probit model.
- If $ε_A$ and $ε_B$ follows an extreme value distribution, then $ε = (ε_A-ε_B)$
follows a logistic distribution, then we will get the logit model.






# A more simple way to set up the model

```{r}
# For example: PaperTime

dat_t$PaperTime = as.numeric(dat_t$PaperTime)

m <- glm(as.factor(socialdemocrats) ~ as.factor(PaperTime), data = dat_t, 
         family = binomial(link='logit'))
summary(m)



m <- glm(as.factor(socialdemocrats) ~ as.factor(PoInt)+as.factor(TradeUn)+as.factor(FamSize)+as.factor(Area), data = dat_t, 
         family = binomial(link='logit'))

summary(m)
```

# Interpretation Template

For example, gre and gpa are continuous variables and rank is likert variable.

> For every one unit change in gre, the log odds of admission (versus non-admission) increases by 0.002.

> For a one unit increase in gpa, the log odds of being admitted to graduate school increases by 0.804.

> The indicator variables for rank have a slightly different interpretation. For example, having attended an undergraduate institution with rank of 2, versus an institution with a rank of 1, changes the log odds of admission by -0.675.
